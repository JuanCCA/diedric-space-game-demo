<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mapa Diédrico Interactivo del Sistema Solar (Escala Real + Nave centrada + Tecla L + Aceleración)</title>
<style>
  html,body{height:100%;margin:0;font-family:sans-serif;background:#05060a;color:#e6eef8}
  #app{display:flex;flex-direction:column;height:100vh;}
  #topPanel,#bottomPanel{flex:1;position:relative;overflow:hidden;background:#02020a}
  canvas{width:100%;height:100%;display:block;cursor:grab}
  #ui{height:220px;box-sizing:border-box;padding:12px;background:#111;color:#eee;overflow:auto}
  .panelTitle{position:absolute;left:8px;top:8px;padding:4px 6px;background:rgba(0,0,0,0.4);border-radius:4px;font-size:13px}
</style>
</head>
<body>
<div id="app">
  <div id="topPanel">
    <div class="panelTitle">Vista A — Top (X-Y)</div>
    <canvas id="canvasTop"></canvas>
  </div>
  <div id="bottomPanel">
    <div class="panelTitle">Vista B — Lateral (X-Z)</div>
    <canvas id="canvasSide"></canvas>
  </div>
  <div id="ui">
    <h2>Panel de control</h2>
    <label>Velocidad simulada (días/s)
      <input id="timeScale" type="range" min="0" max="200" value="20" />
    </label>
    <div>Tiempo: <span id="timeLabel">0.0</span> días</div>
    <label>Velocidad nave (c): <span id="shipSpeedLabel">0.00</span></label><br>
    <div>Escala: <span id="scaleModeLabel">Logarítmica</span> (pulsa L para cambiar)</div>
    <button id="resetView">Reset vista</button>
  </div>
</div>
<script>
const deg2rad=Math.PI/180;

// Radios reales en km
const R_sun=696340;
const AU=149597870.7; // km
const planets = [
  {name:'Mercurio', a:0.387*AU, period:88, inc:7.0*deg2rad, radius:2440},
  {name:'Venus', a:0.723*AU, period:225, inc:3.4*deg2rad, radius:6052},
  {name:'Tierra', a:1.0*AU, period:365, inc:0.0, radius:6371},
  {name:'Marte', a:1.524*AU, period:687, inc:1.8*deg2rad, radius:3389},
  {name:'Júpiter', a:5.203*AU, period:4333, inc:1.3*deg2rad, radius:69911},
  {name:'Saturno', a:9.537*AU, period:10759, inc:2.5*deg2rad, radius:58232},
  {name:'Urano', a:19.191*AU, period:30687, inc:0.8*deg2rad, radius:25362},
  {name:'Neptuno', a:30.07*AU, period:60190, inc:1.8*deg2rad, radius:24622}
];

const canvasTop = document.getElementById('canvasTop');
const ctxTop = canvasTop.getContext('2d');
const canvasSide = document.getElementById('canvasSide');
const ctxSide = canvasSide.getContext('2d');

function resize(){
  [canvasTop,canvasSide].forEach(c=>{
    c.width=c.clientWidth;
    c.height=c.clientHeight;
  });
}
window.addEventListener('resize',resize);
resize();

const c=299792.458; // km/s
const accelPerSecond=0.1*c; // aceleración deseada al mantener tecla
const state={
  scaleMode:'log',
  time:0,
  timeScale:20,
  ship:{x:0,y:0,z:0},
  shipVel:{x:0,y:0,z:0},
  zoom:2e-9, // zoom inicial muy alejado
  keys:{},
  friction:0.995
};
	state.frenando = false; // true = la nave se está frenando

const minDrawRadius=2;

const scaleModeLabel=document.getElementById('scaleModeLabel');
document.getElementById('timeScale').oninput=e=>state.timeScale=+e.target.value;
document.getElementById('resetView').onclick=()=>{state.time=0;};

window.addEventListener('keydown',e=>{
  state.keys[e.code]=true;
  if(e.code==='KeyL'){
    state.scaleMode=state.scaleMode==='log'?'linear':'log';
    scaleModeLabel.textContent=state.scaleMode==='log'?"Logarítmica":"Lineal";
  }
  if(e.code==='KeyF'){
    state.frenando = true; // activa la frenada progresiva
	}
});
window.addEventListener('keyup',e=>{ state.keys[e.code]=false; });

function updateShipSpeedLabel(){
  const speed=Math.sqrt(state.shipVel.x**2+state.shipVel.y**2+state.shipVel.z**2);
  document.getElementById('shipSpeedLabel').textContent=(speed/c).toFixed(2);
}
updateShipSpeedLabel();

window.addEventListener('wheel',e=>{
  e.preventDefault();
  if(e.deltaY<0) state.zoom*=1.1;
  else state.zoom/=1.1;
},{passive:false});

function updateShip(){
  let ax=0, ay=0, az=0;
  const a=accelPerSecond*(1/60); // suponiendo ~60fps, aceleración 0.1c/s

// Si alguna tecla de movimiento está pulsada, cancelamos la frenada
if(state.keys['KeyW'] || state.keys['KeyS'] ||
   state.keys['KeyA'] || state.keys['KeyD'] ||
   state.keys['ArrowUp'] || state.keys['ArrowDown'] ||
   state.keys['ArrowLeft'] || state.keys['ArrowRight']) {
    state.frenando = false;
}


  if(state.keys['KeyW']) ay -= a;
  if(state.keys['KeyS']) ay += a;
  if(state.keys['KeyA']) ax -= a;
  if(state.keys['KeyD']) ax += a;
  if(state.keys['ArrowUp']) az -= a;
  if(state.keys['ArrowDown']) az += a;
  if(state.keys['ArrowLeft']) ax -= a;
  if(state.keys['ArrowRight']) ax += a;

  state.shipVel.x += ax;
  state.shipVel.y += ay;
  state.shipVel.z += az;

  state.ship.x += state.shipVel.x;
  state.ship.y += state.shipVel.y;
  state.ship.z += state.shipVel.z;

  if(state.frenando){  // aplicar fricción solo si está frenando
    state.shipVel.x *= state.friction;
    state.shipVel.y *= state.friction;
    state.shipVel.z *= state.friction;
}

  updateShipSpeedLabel();
}

function mapRadial(dist){
  if(state.scaleMode==='linear') return dist*state.zoom;
  return (Math.log(1+dist/AU)*AU)*state.zoom;
}

function projectTop(x,y){
  let X=mapRadial(x-state.ship.x);
  let Y=mapRadial(y-state.ship.y);
  return {x:X,y:Y};
}
function projectSide(x,z){
  let X=mapRadial(x-state.ship.x);
  let Y=mapRadial(z-state.ship.z);
  return {x:X,y:Y};
}

function drawOrbit(ctx,a,inc){
  ctx.beginPath();
  for(let theta=0;theta<2*Math.PI;theta+=0.05){
    const x0=a*Math.cos(theta);
    const y0=a*Math.sin(theta);
    const z0=0;
    const x=x0;
    const y=y0*Math.cos(inc)-z0*Math.sin(inc);
    const z=y0*Math.sin(inc)+z0*Math.cos(inc);
    const pt=ctx===ctxTop?projectTop(x,y):projectSide(x,z);
    if(theta===0) ctx.moveTo(pt.x,pt.y);
    else ctx.lineTo(pt.x,pt.y);
  }
  ctx.strokeStyle='rgba(255,255,255,0.2)';
  ctx.stroke();
}

function drawBody(ctx,pos,radius,name){
  const drawR=Math.max(minDrawRadius,radius*state.zoom);
  ctx.fillStyle='#fff';
  ctx.beginPath(); ctx.arc(pos.x,pos.y,drawR,0,2*Math.PI); ctx.fill();
  ctx.font=`${10*state.zoom}px sans-serif`; ctx.fillText(name,pos.x+drawR+2,pos.y-2);
}

function draw(){
  state.time += state.timeScale*0.02;
  updateShip();
  document.getElementById('timeLabel').textContent=state.time.toFixed(1);

  [ctxTop,ctxSide].forEach(ctx=>{
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
    ctx.translate(ctx.canvas.width/2,ctx.canvas.height/2);
  });

  const solPosTop=projectTop(0,0);
  drawBody(ctxTop,solPosTop,R_sun,'Sol');
  const solPosSide=projectSide(0,0);
  drawBody(ctxSide,solPosSide,R_sun,'Sol');

  planets.forEach(p=>{
    drawOrbit(ctxTop,p.a,p.inc);
    drawOrbit(ctxSide,p.a,p.inc);

    const angle=2*Math.PI*(state.time/p.period);
    const x0=p.a*Math.cos(angle);
    const y0=p.a*Math.sin(angle);
    const z0=0;
    const x=x0;
    const y=y0*Math.cos(p.inc)-z0*Math.sin(p.inc);
    const z=y0*Math.sin(p.inc)+z0*Math.cos(p.inc);

    const pt=projectTop(x,y);
    drawBody(ctxTop,pt,p.radius,p.name);

    const ps=projectSide(x,z);
    drawBody(ctxSide,ps,p.radius,p.name);
  });

  // Nave en el centro
  const shipRadius=1000;
  const drawR=Math.max(minDrawRadius,shipRadius*state.zoom);
  ctxTop.fillStyle='cyan'; ctxTop.beginPath(); ctxTop.arc(0,0,drawR,0,2*Math.PI); ctxTop.fill();
  ctxSide.fillStyle='cyan'; ctxSide.beginPath(); ctxSide.arc(0,0,drawR,0,2*Math.PI); ctxSide.fill();

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>